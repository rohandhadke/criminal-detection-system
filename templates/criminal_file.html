<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criminal Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { 
            padding: 20px;
            background-color: #f8f9fa;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .profile-header { 
            background-color: #4e73df;
            padding: 30px;
            border-radius: 5px;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }
        .profile-photo { 
            width: 150px; 
            height: 150px; 
            object-fit: cover; 
            border-radius: 50%; 
            border: 5px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            margin-bottom: 25px;
        }
        .card-header {
            background-color: #4e73df;
            color: white;
            border-bottom: none;
            border-radius: 0.5rem 0.5rem 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }
        .info-label {
            font-weight: 600;
            color: #5a5c69;
        }
        .info-value {
            margin-bottom: 10px;
        }
        .badge-wanted {
            background-color: #e74a3b;
        }
        .badge-arrested {
            background-color: #1cc88a;
        }
        .badge-suspect {
            background-color: #f6c23e;
            color: #000;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        .timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e3e6f0;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -30px;
            top: 3px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4e73df;
            border: 2px solid white;
        }
        .timeline-date {
            font-size: 0.85rem;
            color: #6c757d;
        }
        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .timeline-desc {
            font-size: 0.9rem;
            color: #5a5c69;
        }
        @media print {
            body {
                padding: 0;
                background-color: white;
            }
            .no-print {
                display: none !important;
            }
            .card {
                box-shadow: none;
                border: 1px solid #e3e6f0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Profile Header -->
        <div class="profile-header text-center">
            <img src="{{ url_for('static', filename=criminal['photo_path'].replace('static/', '')) }}" class="criminal-photo" alt="Criminal Photo">
            <h2>{{criminal.name}}</h2>
            <span class="badge badge-wanted p-2">{{criminal.status}}</span>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <!-- Personal Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-person-fill me-2"></i>Personal Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="info-label">Full Name</p>
                                <p class="info-value">{{criminal.name}}</p>
                                
                                <p class="info-label">Gender</p>
                                <p class="info-value">{{criminal.gender}}</p>
                                
                                <p class="info-label">Nationality</p>
                                <p class="info-value">Indian</p>
                            </div>
                            <div class="col-md-6">
                                <p class="info-label">Date of Birth</p>
                                <p class="info-value">{{criminal.dob}}</p>

                                <p class="info-label">Age</p>
                                <p class="info-value">{{criminal.age}}</p>

                                
                                <p class="info-label">Aadhaar Number</p>
                                <p class="info-value">{{criminal.aadhaar}}</p>
                                
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Physical Description -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-person-bounding-box me-2"></i>Physical Description</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="info-label">Height</p>
                                <p class="info-value">175 cm (5'9")</p>
                                
                                <p class="info-label">Weight</p>
                                <p class="info-value">68 kg</p>
                                
                                <p class="info-label">Hair Color</p>
                                <p class="info-value">Black</p>
                            </div>
                            <div class="col-md-6">
                                <p class="info-label">Eye Color</p>
                                <p class="info-value">Brown</p>
                                
                                <p class="info-label">Distinguishing Marks</p>
                                <p class="info-value">Scar on left cheek, tattoo on right forearm</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Contact Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-geo-alt-fill me-2"></i>Contact Information</h5>
                    </div>
                    <div class="card-body">
                        <p class="info-label">Permanent Address</p>
                        <p class="info-value">123 Main Street, Andheri East, Mumbai, Maharashtra - 400069</p>
                        
                        <p class="info-label">Last Known Address</p>
                        <p class="info-value">45/B, Saki Naka, Andheri East, Mumbai</p>
                        
                        <p class="info-label">Phone Numbers</p>
                        <p class="info-value">
                            +91 98765 43210 (Primary)<br>
                            +91 87654 32109 (Secondary)
                        </p>
                        
                        <p class="info-label">Email Addresses</p>
                        <p class="info-value">
                            rajesh.kumar@gmail.com<br>
                            rkumar7890@protonmail.com
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <!-- Criminal Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-shield-exclamation me-2"></i>Criminal Information</h5>
                    </div>
                    <div class="card-body">
                        <p class="info-label">Status</p>
                        <p class="info-value"><span class="badge badge-wanted p-2">Wanted</span></p>
                        
                        <p class="info-label">Bank Status</p>
                        <p class="info-value"><span class="badge bg-success p-2">Active</span></p>
                        
                        <p class="info-label">Primary Crime Type</p>
                        <p class="info-value">Financial Fraud</p>
                        
                        <p class="info-label">Known Modus Operandi</p>
                        <p class="info-value">Phishing calls posing as bank officials to obtain OTPs and account details</p>
                        
                        <p class="info-label">FIR Number</p>
                        <p class="info-value">FIR/2023/4567</p>
                        
                        <p class="info-label">Case Status</p>
                        <p class="info-value">Ongoing Investigation</p>
                        
                        <p class="info-label">Last Arrest Date</p>
                        <p class="info-value">12/05/2022 (Released on bail)</p>
                        
                        <p class="info-label">Known Associates</p>
                        <p class="info-value">5 identified, 2 arrested</p>
                    </div>
                </div>
                
                <!-- Banking Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-credit-card-2-front-fill me-2"></i>Banking Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="info-label">Linked Bank Accounts</p>
                
                        {% if atm_users %}
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Card Number</th>
                                        <th>Balance</th>
                                        <th>Account Type</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for user in atm_users %}
                                    <tr>
                                        <td>{{ user.card_number }}</td>
                                        <td>₹{{ "{:,.2f}".format(user.balance) }}</td>
                                        <td>{{ user.account_type | capitalize }}</td>
                                        <td>
                                            {% if user.account_status == 'active' %}
                                                <span class="badge bg-success">Active</span>
                                            {% else %}
                                                <span class="badge bg-danger">Blocked</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                
                        <p class="info-label">Last Transaction</p>
                        {% if atm_transactions %}
                            {% set last_txn = atm_transactions[0] %}
                            <p class="info-value">
                                ₹{{ "{:,.2f}".format(last_txn.amount) }} {{ last_txn.type | lower }}ed on {{ last_txn.date }}
                            </p>
                        {% else %}
                            <p class="info-value">No transactions found.</p>
                        {% endif %}
                
                        {% else %}
                        <p>No ATM user accounts linked to this Aadhaar number.</p>
                        {% endif %}
                
                        <div class="d-grid gap-2 mt-3 no-print">
                            {% if atm_users and atm_users|length > 0 and atm_users[0].account_status == 'blocked' %}
                            <button class="btn btn-success" onclick="unblockAllAccounts('{{ criminal._id }}')">
                                <i class="bi bi-credit-card"></i> Unblock All Bank Accounts
                            </button>
                        {% else %}
                            <button class="btn btn-danger" onclick="blockAllAccounts('{{ criminal._id }}')">
                                <i class="bi bi-credit-card"></i> Block All Bank Accounts
                            </button>
                        {% endif %}
                        </div>
                    </div>
                </div>                
            </div>
        </div>
        
        <!-- Criminal Timeline -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Criminal Timeline</h5>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">15/07/1991</div>
                        <div class="timeline-title">Born in Mumbai, Maharashtra</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">12/03/2015</div>
                        <div class="timeline-title">First criminal record</div>
                        <div class="timeline-desc">Arrested for credit card fraud in Delhi. Served 6 months in jail.</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">20/08/2018</div>
                        <div class="timeline-title">Involved in online scam network</div>
                        <div class="timeline-desc">Identified as part of international phishing operation targeting bank customers.</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">12/05/2022</div>
                        <div class="timeline-title">Last Arrest</div>
                        <div class="timeline-desc">Caught in Bangalore for impersonating bank official. Released on bail after 3 months.</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">15/06/2023</div>
                        <div class="timeline-title">Current Warrant Issued</div>
                        <div class="timeline-desc">Warrant issued for involvement in ₹2.5 crore senior citizen fraud case.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Case Details -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-file-earmark-text-fill me-2"></i>Case Details</h5>
            </div>
            <div class="card-body">
                <p class="info-label">Current Case Description</p>
                <p class="info-value">Involved in multiple online fraud cases targeting senior citizens. Suspected to be part of an international scam network operating from Mumbai, Delhi and Bangalore. Primary method involves phishing calls posing as bank officials to obtain OTPs and account details.</p>
                
                <p class="info-label">Known Associates</p>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Last Known Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Sunil Verma</td>
                                <td>Money Mule</td>
                                <td><span class="badge badge-arrested">Arrested</span></td>
                                <td>Mumbai Central Jail</td>
                            </tr>
                            <tr>
                                <td>Vikram Malhotra</td>
                                <td>Tech Support</td>
                                <td><span class="badge badge-wanted">Wanted</span></td>
                                <td>Dubai (suspected)</td>
                            </tr>
                            <tr>
                                <td>Rahul Sharma</td>
                                <td>Call Operator</td>
                                <td><span class="badge badge-arrested">Arrested</span></td>
                                <td>Tihar Jail, Delhi</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <p class="info-label">Evidence Collected</p>
                <ul>
                    <li>Call recordings from victims' phones</li>
                    <li>Bank transaction records tracing to accounts controlled by suspect</li>
                    <li>IP address logs linking to known operations</li>
                    <li>Testimony from arrested associates</li>
                </ul>
            </div>
        </div>
        
        <!-- Footer with print button -->
        <div class="d-flex justify-content-end mb-4 no-print">
            <button class="btn btn-primary" onclick="window.print()">
                <i class="bi bi-printer-fill"></i> Print Profile
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // This function would be called from the parent window to load specific criminal data
        function loadCriminalData(criminalId) {
            // In a real application, this would fetch data from your backend
            console.log("Loading data for criminal ID:", criminalId);
            
            // Here you would typically make an AJAX call to your backend
            // fetch(`/api/criminals/${criminalId}`)
            //     .then(response => response.json())
            //     .then(data => populateProfile(data))
            //     .catch(error => console.error('Error:', error));
        }
        
        // Function to populate the profile with data
        function populateProfile(data) {
            // This would update all the fields in the profile with the actual data
            document.querySelector('.profile-photo').src = data.photoUrl;
            document.querySelector('h2').textContent = data.name;
            // And so on for all other fields...
        }
        
        // Call load function when page loads (with a sample ID for demonstration)
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const criminalId = urlParams.get('id') || 'CRIM-2023-7890';
            loadCriminalData(criminalId);
        };

        function blockAllAccounts(criminalId) {
            fetch(`/police/block_accounts/${criminalId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();  // reload to reflect status change
            })
            .catch(error => {
                console.error('Error blocking accounts:', error);
                alert('An error occurred.');
            });
        }
        function unblockAllAccounts(criminalId) {
            fetch(`/police/unblock_accounts/${criminalId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            });
        }

    </script>
</body>
</html>